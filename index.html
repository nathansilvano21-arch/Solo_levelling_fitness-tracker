<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Shed Raid: Solo Leveling</title>
    <style>
        :root { --gold: #ffd700; --blue: #00d4ff; --bg: #0b0b0d; --card: #16161a; --green: #30d158; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px 15px 140px 15px; -webkit-tap-highlight-color: transparent; }
        .hud { background: linear-gradient(145deg, #1c1c22, #000); padding: 20px; border-radius: 20px; border: 1px solid #333; margin-bottom: 20px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
        .player-name { font-size: 24px; font-weight: 900; letter-spacing: 2px; color: var(--blue); border: none; background: transparent; width: 100%; outline: none; text-transform: uppercase; }
        .rank-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .rank { font-size: 11px; color: #888; text-transform: uppercase; font-weight: bold; }
        .spec-tag { font-size: 10px; background: #333; color: var(--gold); padding: 2px 8px; border-radius: 4px; font-weight: bold; border: 1px solid var(--gold); }
        .lvl-text { display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 5px; font-weight: bold;}
        .xp-bar-bg { background: #333; height: 12px; border-radius: 6px; overflow: hidden; border: 1px solid #444; }
        #xp-bar-fill { background: linear-gradient(90deg, var(--blue), var(--gold)); height: 100%; width: 0%; transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        .stats-row { display: flex; justify-content: space-around; margin-top: 15px; border-top: 1px solid #333; padding-top: 15px; }
        .stat-box { text-align: center; }
        .stat-label { font-size: 9px; color: #888; text-transform: uppercase; }
        .stat-val { font-size: 16px; font-weight: bold; color: var(--gold); }
        .achievement-log { background: #000; padding: 10px; border-radius: 10px; margin-top: 15px; font-size: 11px; max-height: 100px; overflow-y: auto; border: 1px dashed #444; }
        .ach-item { color: var(--green); margin-bottom: 4px; display: block; font-family: monospace; }
        .day { background: var(--card); border-radius: 16px; padding: 18px; margin-bottom: 20px; border: 1px solid #222; }
        h2 { color: var(--blue); font-size: 14px; text-transform: uppercase; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 8px; letter-spacing: 1px; }
        .row { display: flex; align-items: center; justify-content: space-between; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 8px; }
        .task-info { display: flex; flex-direction: column; }
        .task-name { font-size: 14px; font-weight: bold; color: #eee; }
        .task-vol { font-size: 10px; color: var(--gold); text-transform: uppercase; font-weight: bold; }
        input[type="checkbox"] { width: 24px; height: 24px; accent-color: var(--blue); margin-right: 12px; flex-shrink: 0; }
        .small-box { width: 65px; background: #333; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 6px; text-align: center; font-size: 14px; outline: none; }
        .quest-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .water-btn { background: #1e293b; border: 1px solid var(--blue); color: var(--blue); padding: 10px; border-radius: 8px; font-size: 12px; text-align: center; font-weight: bold; }
        .water-btn.active { background: var(--blue); color: #000; }
        select { width: 100%; background: #222; color: var(--gold); border: 1px solid var(--gold); padding: 14px; border-radius: 12px; margin-bottom: 20px; font-size: 14px; font-weight: bold; outline: none; }
        .sync-row { display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid #333; padding-top: 15px; }
        .sync-btn { flex: 1; background: #222; border: 1px solid #444; color: #aaa; font-size: 10px; padding: 10px; border-radius: 8px; text-transform: uppercase; font-weight: bold; }
        .reset-btn { position: fixed; bottom: 20px; left: 20px; right: 20px; background: #fff; color: #000; border: none; padding: 20px; border-radius: 16px; font-weight: 900; z-index: 1001; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
    </style>
</head>
<body>

<div class="hud">
    <input type="text" id="player-name-input" class="player-name" placeholder="HUNTER NAME" oninput="saveName(this.value)">
    <div class="rank-row">
        <div id="rank-display" class="rank">RANK: E-RANK HUNTER</div>
        <div id="spec-display" class="spec-tag">THE ASPIRANT</div>
    </div>
    <div class="lvl-container">
        <div class="lvl-text"><span>LVL <span id="current-lvl">1</span></span><span id="xp-ratio">0 XP</span></div>
        <div class="xp-bar-bg"><div id="xp-bar-fill"></div></div>
    </div>
    <div class="stats-row">
        <div class="stat-box"><div class="stat-label">STR XP</div><div id="stat-str" class="stat-val">0</div></div>
        <div class="stat-box"><div class="stat-label">Total XP</div><div id="stat-total" class="stat-val">0</div></div>
    </div>
    <div id="ach-container" class="achievement-log"><span style="color:#444">Scanning for milestones...</span></div>
    <div class="sync-row">
        <button class="sync-btn" onclick="exportSave()">Backup ID</button>
        <button class="sync-btn" onclick="importSave()">Restore ID</button>
    </div>
</div>

<select id="week-focus" onchange="updateFocus(this.value)">
    <option value="none">-- Select Raid Focus --</option>
    <option value="arms">Arms Specialization</option>
    <option value="chest">Chest Specialization</option>
    <option value="back">Back Specialization</option>
    <option value="shoulders">Shoulder Specialization</option>
</select>

<div id="content"></div>
<button class="reset-btn" onclick="resetWeek()">Bank XP & End Cycle</button>

<script>
    const library = {
        arms: [[{n:"Bike Cardio",v:"10m"},{n:"BB Curls",v:"3x10"},{n:"Close Bench",v:"3x8"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"10m"},{n:"DB Hammer Curls",v:"3x12"},{n:"Bench Dips",v:"3xMax"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"10m"},{n:"Zottman Curls",v:"3x12"},{n:"Skullcrushers",v:"3x10"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"10m"},{n:"Concentration Curls",v:"3x10"},{n:"DB Kickbacks",v:"3x12"},{n:"Leg Raises",v:"3x15"}]],
        chest: [[{n:"Bike Cardio",v:"10m"},{n:"BB Bench",v:"3x8"},{n:"Svend Press",v:"3x15"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"10m"},{n:"Incline DB Press",v:"3x10"},{n:"Pushups",v:"3xMax"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"10m"},{n:"Close Grip Bench",v:"3x10"},{n:"Floor Press",v:"3x12"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"10m"},{n:"Pause Bench",v:"3x8"},{n:"Incline Pushups",v:"3xMax"},{n:"Leg Raises",v:"3x15"}]],
        back: [[{n:"Bike Cardio",v:"10m"},{n:"BB Bent Row",v:"3x8"},{n:"BB Shrugs",v:"3x12"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"10m"},{n:"DB Deadlift",v:"3x10"},{n:"Single Arm Row",v:"3x10"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"10m"},{n:"Romanian Deadlift",v:"3x10"},{n:"Reverse Flyes",v:"3x15"},{n:"Leg Raises",v:"3x15"}],[{n:"Bike Cardio",v:"10m"},{n:"Upright Row",v:"3x10"},{n:"DB Shrugs",v:"3x15"},{n:"Goblet Squat",v:"3x12"}]],
        shoulders: [[{n:"Bike Cardio",v:"10m"},{n:"Seated BB OHP",v:"3x8"},{n:"Lateral Raise",v:"3x12"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"10m"},{n:"Seated Arnold",v:"3x10"},{n:"Front Raise",v:"3x12"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"10m"},{n:"Rear Delt Flyes",v:"3x15"},{n:"Face Pulls",v:"3x15"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"10m"},{n:"Seated DB Press",v:"3x10"},{n:"High Pulls",v:"3x12"},{n:"Leg Raises",v:"3x15"}]]
    };

    const sessions = [{id:0, label:"Session 1: Power", type:"gym", idx:0},{id:1, label:"Session 2: Volume", type:"gym", idx:1},{id:2, label:"Session 3: Recovery Path", type:"walk"},{id:3, label:"Session 4: Hypertrophy", type:"gym", idx:2},{id:4, label:"Session 5: The Grind", type:"gym", idx:3},{id:5, label:"Session 6: Endurance Path", type:"walk"},{id:6, label:"Session 7: Final Stretch", type:"walk"}];

    function saveName(val) { localStorage.setItem('playerName', val); }
    function exportSave() { const saveData = { name: localStorage.getItem('playerName') || 'HUNTER', xp: localStorage.getItem('lifetimeXP') || '0', specs: localStorage.getItem('specCounts') || '{}', milestones: localStorage.getItem('milestones') || '[]', cycles: localStorage.getItem('cycleCount') || '0' }; prompt("COPY HUNTER ID CODE:", btoa(JSON.stringify(saveData))); }
    function importSave() { const code = prompt("PASTE HUNTER ID CODE:"); if (code) { try { const data = JSON.parse(atob(code)); localStorage.setItem('playerName', data.name); localStorage.setItem('lifetimeXP', data.xp); localStorage.setItem('specCounts', data.specs); localStorage.setItem('milestones', data.milestones); localStorage.setItem('cycleCount', data.cycles); location.reload(); } catch(e) { alert("Invalid ID Code."); } } }

    function updateFocus(v) { 
        localStorage.setItem('focus', v);
        render(); 
    }

    function render() {
        const focus = localStorage.getItem('focus') || 'none';
        document.getElementById('player-name-input').value = localStorage.getItem('playerName') || 'HUNTER';
        document.getElementById('week-focus').value = focus;
        let html = '';
        sessions.forEach(sess => {
            html += `<div class="day"><h2>${sess.label}</h2>`;
            if (sess.type === "gym" && focus !== 'none') {
                library[focus][sess.idx].forEach((task, j) => {
                    const id = `c-${sess.id}-${j}`, kid = `k-${sess.id}-${j}`;
                    html += `<div class="row"><div style="display:flex;align-items:center;"><input type="checkbox" class="cb" id="${id}" ${localStorage.getItem(id)==='true'?'checked':''}> <div class="task-info"><span class="task-name">${task.n}</span><span class="task-vol">${task.v}</span></div></div><input type="text" class="iv small-box ${task.n.includes('Bike')?'km-field':''}" id="${kid}" value="${localStorage.getItem(kid)||''}" placeholder="${task.n.includes('Bike')?'km':'kg'}"></div>`;
                });
            } else if (sess.type === "walk") {
                const cid = `c-${sess.id}-0`;
                html += `<div class="row"><div><input type="checkbox" class="cb" id="${cid}" ${localStorage.getItem(cid)==='true'?'checked':''}> Outdoor Walk / Cardio Session</div></div>`;
            }
            const wKey = `water-${sess.id}`, waterVal = parseInt(localStorage.getItem(wKey)) || 0;
            html += `<div class="quest-grid"><div class="water-btn ${waterVal>=3?'active':''}" onclick="addWater(${sess.id})">ðŸ’§ ${waterVal}/3L Water</div><div class="field"><input type="text" class="iv small-box step-field" style="width:100%" id="s-${sess.id}" value="${localStorage.getItem('s-'+sess.id)||''}" placeholder="Steps"></div></div>`;
            html += `<div class="stats-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;"><div class="field"><label class="stat-label">Daily Calories</label><input type="number" class="iv small-box" style="width:100%" id="cal-${sess.id}" value="${localStorage.getItem('cal-'+sess.id)||''}" placeholder="kcal"></div></div></div>`;
        });
        document.getElementById('content').innerHTML = html;
        calculateXP();
    }

    function addWater(id) { let val = (parseInt(localStorage.getItem(`water-${id}`)) || 0) + 1; localStorage.setItem(`water-${id}`, val > 3 ? 0 : val); render(); }

    function calculateXP() {
        let weeklyXP = 0, strXP = 0;
        document.querySelectorAll('.cb').forEach(cb => { if(cb.checked) { const weightField = document.getElementById(cb.id.replace('c-', 'k-')); const weight = weightField ? parseFloat(weightField.value) || 0 : 0; strXP += (2 + (weight * 0.01)); } });
        document.querySelectorAll('.km-field').forEach(f => { weeklyXP += (parseFloat(f.value) || 0) * 1; });
        document.querySelectorAll('.step-field').forEach(f => { weeklyXP += (parseInt(f.value) || 0) * 0.0005; });
        for(let i=0; i<7; i++) { if(localStorage.getItem(`water-${i}`) >= 3) weeklyXP += 5; }
        let bankedXP = parseFloat(localStorage.getItem('lifetimeXP')) || 0;
        let milestoneBonus = checkMilestones(bankedXP + weeklyXP + strXP);
        let totalXP = bankedXP + weeklyXP + strXP + milestoneBonus;
        let level = (totalXP >= 10) ? Math.floor(Math.sqrt(totalXP / 10)) + 1 : 1;
        const xpCurr = (level === 1) ? 0 : Math.pow(level - 1, 2) * 10, xpNext = Math.pow(level, 2) * 10;
        document.getElementById('current-lvl').innerText = level;
        document.getElementById('xp-bar-fill').style.width = ((totalXP - xpCurr) / (xpNext - xpCurr) * 100) + "%";
        document.getElementById('xp-ratio').innerText = `${Math.round(totalXP)} XP`;
        document.getElementById('stat-str').innerText = Math.round(strXP);
        document.getElementById('stat-total').innerText = Math.round(totalXP);
        let rank = "E-RANK";
        if(level > 10) rank = "D-RANK"; if(level > 25) rank = "C-RANK"; if(level > 50) rank = "B-RANK"; if(level > 80) rank = "A-RANK"; if(level > 120) rank = "S-RANK";
        document.getElementById('rank-display').innerText = `RANK: ${rank} HUNTER`;

        // FIXED TITLE LOGIC
        let counts = JSON.parse(localStorage.getItem('specCounts') || '{"arms":0,"chest":0,"back":0,"shoulders":0}');
        let cycles = parseInt(localStorage.getItem('cycleCount') || 0);
        let max = Math.max(counts.arms, counts.chest, counts.back, counts.shoulders);
        let title = "THE ASPIRANT";
        if(cycles > 0) {
            if (max === 0) title = "THE ALL-ROUNDER";
            else if(counts.arms === max) title = "THE DUAL-WIELDER";
            else if(counts.chest === max) title = "THE IRON BASTION";
            else if(counts.back === max) title = "THE TITAN PILLAR";
            else if(counts.shoulders === max) title = "THE BOULDER KING";
        }
        document.getElementById('spec-display').innerText = title;
    }

    function checkMilestones(total) {
        let milestones = JSON.parse(localStorage.getItem('milestones') || '[]');
        let bonus = 0;
        const goals = [{id: 'c1', name: "Centurion I", req: 1000, reward: 25},{id: 'c2', name: "Centurion II", req: 5000, reward: 50},{id: 'c3', name: "Centurion III", req: 15000, reward: 100},{id: 'e1', name: "Earth Walker I", req: 2500, reward: 25},{id: 'e2', name: "Earth Walker II", req: 10000, reward: 75},{id: 'core1', name: "Consistent Core I", req: 500, reward: 20},{id: 'core2', name: "Consistent Core II", req: 2500, reward: 50}];
        let logHtml = "";
        goals.forEach(g => {
            if (total >= g.req && !milestones.includes(g.id)) { milestones.push(g.id); localStorage.setItem('milestones', JSON.stringify(milestones)); alert(`UNLOCKED: ${g.name}`); }
            if (milestones.includes(g.id)) { logHtml += `<span class="ach-item">âœ” ${g.name.padEnd(18)} +${g.reward}XP</span>`; bonus += g.reward; }
        });
        document.getElementById('ach-container').innerHTML = logHtml || '<span style="color:#444">Scanning for milestones...</span>';
        return bonus;
    }

    document.addEventListener('input', (e) => { localStorage.setItem(e.target.id, e.target.type === 'checkbox' ? e.target.checked : e.target.value); calculateXP(); });

    function resetWeek() {
        if(confirm("Bank current raid cycle? Title will be updated based on focus.")) {
            let weeklyXP = 0, strXP = 0;
            document.querySelectorAll('.cb').forEach(cb => { if(cb.checked) { const weight = parseFloat(document.getElementById(cb.id.replace('c-', 'k-'))?.value) || 0; strXP += (2 + (weight * 0.01)); } });
            document.querySelectorAll('.km-field').forEach(f => { weeklyXP += (parseFloat(f.value) || 0) * 1; });
            document.querySelectorAll('.step-field').forEach(f => { weeklyXP += (parseInt(f.value) || 0) * 0.0005; });
            for(let i=0; i<7; i++) { if(localStorage.getItem(`water-${i}`) >= 3) weeklyXP += 5; }
            
            let focus = localStorage.getItem('focus') || 'none';
            let counts = JSON.parse(localStorage.getItem('specCounts') || '{"arms":0,"chest":0,"back":0,"shoulders":0}');
            if(focus !== 'none') counts[focus]++;
            localStorage.setItem('specCounts', JSON.stringify(counts));

            let banked = parseFloat(localStorage.getItem('lifetimeXP')) || 0;
            let bonus = checkMilestones(banked + weeklyXP + strXP);
            localStorage.setItem('lifetimeXP', banked + weeklyXP + strXP + bonus);
            localStorage.setItem('cycleCount', parseInt(localStorage.getItem('cycleCount') || 0) + 1);

            sessions.forEach(sess => { for(let j=0; j<10; j++) { localStorage.removeItem(`c-${sess.id}-${j}`); localStorage.removeItem(`k-${sess.id}-${j}`); } localStorage.removeItem(`water-${sess.id}`); localStorage.removeItem(`s-${sess.id}`); localStorage.removeItem(`d-${sess.id}`); localStorage.removeItem(`cal-${sess.id}`); });
            location.reload();
        }
    }
    window.onload = render;
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Shed Raid: Solo Leveling</title>
    <style>
        :root { --gold: #ffd700; --blue: #00d4ff; --bg: #0b0b0d; --card: #16161a; --green: #30d158; --red: #ff3b30; --rank-color: #444; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px 15px 160px 15px; -webkit-tap-highlight-color: transparent; }
        
        .hud { 
            background: linear-gradient(145deg, #1c1c22, #000); 
            padding: 20px; border-radius: 20px; 
            border: 2px solid var(--rank-color); 
            margin-bottom: 20px; position: sticky; top: 10px; z-index: 1000; 
            box-shadow: 0 0 15px var(--rank-color);
            transition: all 0.5s ease;
        }

        .player-name { font-size: 22px; font-weight: 900; letter-spacing: 2px; color: var(--blue); border: none; background: transparent; width: 100%; outline: none; text-transform: uppercase; }
        .rank-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .rank { font-size: 11px; color: #888; text-transform: uppercase; font-weight: bold; }
        .spec-tag { font-size: 10px; background: #333; color: var(--gold); padding: 2px 8px; border-radius: 4px; font-weight: bold; border: 1px solid var(--gold); }
        
        /* Resource Bars */
        .bar-container { margin-bottom: 8px; }
        .bar-label { display: flex; justify-content: space-between; font-size: 10px; font-weight: bold; margin-bottom: 3px; text-transform: uppercase; }
        .bar-bg { background: #222; height: 8px; border-radius: 4px; overflow: hidden; border: 1px solid #333; }
        .bar-fill { height: 100%; width: 0%; transition: 0.8s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
        
        #xp-fill { background: linear-gradient(90deg, var(--blue), var(--gold)); }
        #hp-fill { background: var(--green); } /* Health = Water/Steps Consistency */
        #mp-fill { background: var(--blue); }  /* Mana = Gym Completion */

        /* Quest Box */
        .quest-box { background: rgba(255, 215, 0, 0.05); border: 1px dashed var(--gold); padding: 12px; border-radius: 12px; margin-top: 15px; }
        .quest-title { font-size: 9px; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .quest-desc { font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 10px; }

        .mode-toggle { font-size: 10px; background: #222; border: 1px solid #444; color: #888; padding: 5px 10px; border-radius: 20px; font-weight: bold; margin-left: auto; }
        .mode-toggle.active { background: var(--blue); color: #000; border-color: #fff; }

        .stats-row { display: flex; justify-content: space-around; margin-top: 15px; border-top: 1px solid #333; padding-top: 15px; }
        .stat-val { font-size: 16px; font-weight: bold; color: var(--gold); }
        .stat-label { font-size: 9px; color: #888; text-transform: uppercase; }

        .day { background: var(--card); border-radius: 16px; padding: 18px; margin-bottom: 20px; border: 1px solid #222; }
        h2 { color: var(--blue); font-size: 13px; text-transform: uppercase; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 8px; }
        .row { display: flex; align-items: center; justify-content: space-between; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 8px; }
        
        input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--blue); }
        .small-box { width: 55px; background: #333; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 6px; text-align: center; font-size: 12px; }
        
        .water-btn { background: #1e293b; border: 1px solid var(--blue); color: var(--blue); padding: 10px; border-radius: 8px; font-size: 11px; text-align: center; font-weight: bold; }
        .water-btn.active { background: var(--blue); color: #000; }

        .reset-btn { position: fixed; bottom: 20px; left: 20px; right: 20px; background: #fff; color: #000; border: none; padding: 20px; border-radius: 16px; font-weight: 900; z-index: 1001; text-transform: uppercase; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        select { width: 100%; background: #222; color: var(--gold); border: 1px solid var(--gold); padding: 14px; border-radius: 12px; margin-bottom: 20px; }
        
        /* Level Up Overlay */
        #lvl-up-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="lvl-up-overlay">
    <h1 style="color: var(--gold); font-size: 40px; margin: 0;">LEVEL UP</h1>
    <p id="lvl-up-msg" style="font-size: 18px; color: var(--blue);"></p>
</div>

<div class="hud" id="main-hud">
    <input type="text" id="player-name-input" class="player-name" placeholder="HUNTER NAME" oninput="saveName(this.value)">
    <div class="rank-row">
        <div id="rank-display" class="rank">RANK: E-RANK</div>
        <div id="spec-display" class="spec-tag">THE ASPIRANT</div>
    </div>
    
    <div class="bar-container">
        <div class="bar-label"><span>Experience</span><span id="xp-ratio">0 XP</span></div>
        <div class="bar-bg"><div id="xp-fill" class="bar-fill"></div></div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div class="bar-container">
            <div class="bar-label"><span>HP (Vitality)</span></div>
            <div class="bar-bg"><div id="hp-fill" class="bar-fill"></div></div>
        </div>
        <div class="bar-container">
            <div class="bar-label"><span>MP (Will)</span></div>
            <div class="bar-bg"><div id="mp-fill" class="bar-fill"></div></div>
        </div>
    </div>

    <div class="quest-box">
        <div class="quest-title">Weekly Bonus Objective</div>
        <div class="quest-desc">
            <input type="checkbox" id="daily-duty">
            <span id="quest-text">Loading Quest...</span>
        </div>
    </div>

    <div style="margin-top:15px; display:flex; align-items:center;">
        <div class="stat-label" style="color:#555">Raid Status:</div>
        <button id="rest-mode-btn" class="mode-toggle" onclick="toggleRestMode()">Raid Active</button>
    </div>

    <div class="stats-row">
        <div class="stat-box"><div class="stat-label">STR</div><div id="stat-str" class="stat-val">0</div></div>
        <div class="stat-box"><div class="stat-label">Cycle</div><div id="stat-cycle" class="stat-val">0</div></div>
        <div class="stat-box"><div class="stat-label">Total XP</div><div id="stat-total" class="stat-val">0</div></div>
    </div>
</div>

<select id="week-focus" onchange="updateFocus(this.value)">
    <option value="none">-- Select Raid Specialization --</option>
    <option value="arms">Arms Specialization</option>
    <option value="chest">Chest Specialization</option>
    <option value="back">Back Specialization</option>
    <option value="shoulders">Shoulder Specialization</option>
</select>

<div id="content"></div>

<button class="reset-btn" onclick="resetWeek()">Bank Cycle & Rank Up</button>

<script>
    const quests = [
        "Drink 21L Water (3L/day)",
        "Walk 50,000 Total Steps",
        "Complete All Gym Sessions",
        "Zero Missed Water Goals",
        "Walk 15km Total Distance",
        "Achieve 50+ STR Points"
    ];

    const library = {
        arms: [[{n:"Bike Cardio",v:"Mins / KM"},{n:"BB Curls",v:"3x10"},{n:"Close Bench",v:"3x8"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"DB Hammer Curls",v:"3x12"},{n:"Bench Dips",v:"3xMax"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Zottman Curls",v:"3x12"},{n:"Skullcrushers",v:"3x10"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Concentration Curls",v:"3x10"},{n:"DB Kickbacks",v:"3x12"},{n:"Leg Raises",v:"3x15"}]],
        chest: [[{n:"Bike Cardio",v:"Mins / KM"},{n:"BB Bench",v:"3x8"},{n:"Svend Press",v:"3x15"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Incline DB Press",v:"3x10"},{n:"Pushups",v:"3xMax"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Close Grip Bench",v:"3x10"},{n:"Floor Press",v:"3x12"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Pause Bench",v:"3x8"},{n:"Incline Pushups",v:"3xMax"},{n:"Leg Raises",v:"3x15"}]],
        back: [[{n:"Bike Cardio",v:"Mins / KM"},{n:"BB Bent Row",v:"3x8"},{n:"BB Shrugs",v:"3x12"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"DB Deadlift",v:"3x10"},{n:"Single Arm Row",v:"3x10"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Romanian Deadlift",v:"3x10"},{n:"Reverse Flyes",v:"3x15"},{n:"Leg Raises",v:"3x15"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Upright Row",v:"3x10"},{n:"DB Shrugs",v:"3x15"},{n:"Goblet Squat",v:"3x12"}]],
        shoulders: [[{n:"Bike Cardio",v:"Mins / KM"},{n:"Seated BB OHP",v:"3x8"},{n:"Lateral Raise",v:"3x12"},{n:"Goblet Squat",v:"3x12"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Seated Arnold",v:"3x10"},{n:"Front Raise",v:"3x12"},{n:"DB Deadlift",v:"3x10"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Rear Delt Flyes",v:"3x15"},{n:"Face Pulls",v:"3x15"},{n:"Plank",v:"1m"}],[{n:"Bike Cardio",v:"Mins / KM"},{n:"Seated DB Press",v:"3x10"},{n:"High Pulls",v:"3x12"},{n:"Leg Raises",v:"3x15"}]]
    };

    const sessions = [{id:0, label:"Session 1", type:"gym", idx:0},{id:1, label:"Session 2", type:"gym", idx:1},{id:2, label:"Session 3", type:"walk"},{id:3, label:"Session 4", type:"gym", idx:2},{id:4, label:"Session 5", type:"gym", idx:3},{id:5, label:"Session 6", type:"walk"},{id:6, label:"Session 7", type:"walk"}];

    function triggerHaptic(ms=50) { if(window.navigator.vibrate) window.navigator.vibrate(ms); }

    function saveName(v) { localStorage.setItem('playerName', v); }
    
    function toggleRestMode() {
        let mode = localStorage.getItem('restMode') === 'true';
        localStorage.setItem('restMode', !mode);
        triggerHaptic(100);
        render();
    }

    function render() {
        const focus = localStorage.getItem('focus') || 'none';
        const rest = localStorage.getItem('restMode') === 'true';
        document.getElementById('player-name-input').value = localStorage.getItem('playerName') || 'HUNTER';
        document.getElementById('week-focus').value = focus;
        document.getElementById('rest-mode-btn').innerText = rest ? "Rest Mode" : "Raid Active";
        document.getElementById('rest-mode-btn').className = rest ? "mode-toggle active" : "mode-toggle";
        
        // Quest Setup
        let currentQuest = localStorage.getItem('activeQuest');
        if(!currentQuest) {
            currentQuest = quests[Math.floor(Math.random() * quests.length)];
            localStorage.setItem('activeQuest', currentQuest);
        }
        document.getElementById('quest-text').innerText = currentQuest;
        document.getElementById('daily-duty').checked = localStorage.getItem('daily-duty') === 'true';

        let html = '';
        sessions.forEach(sess => {
            if (rest && sess.type === "gym") return;
            html += `<div class="day"><h2>${sess.label}</h2>`;
            if (sess.type === "gym" && focus !== 'none') {
                library[focus][sess.idx].forEach((task, j) => {
                    const id = `c-${sess.id}-${j}`, kid = `k-${sess.id}-${j}`, tid = `t-${sess.id}-${j}`;
                    const isBike = task.n.includes('Bike');
                    html += `<div class="row">
                        <div style="display:flex;align-items:center;">
                            <input type="checkbox" class="cb" id="${id}" ${localStorage.getItem(id)==='true'?'checked':''} onchange="triggerHaptic()"> 
                            <div class="task-info" style="margin-left:10px"><div class="task-name" style="font-size:14px; font-weight:bold">${task.n}</div><div class="task-vol" style="font-size:10px; color:var(--gold)">${task.v}</div></div>
                        </div>
                        <div style="display:flex; gap:5px;">
                            ${isBike ? `<input type="text" class="iv small-box" id="${tid}" value="${localStorage.getItem(tid)||''}" placeholder="Min">` : ''}
                            <input type="text" class="iv small-box ${isBike?'km-field':''}" id="${kid}" value="${localStorage.getItem(kid)||''}" placeholder="${isBike?'km':'kg'}">
                        </div>
                    </div>`;
                });
            } else if (sess.type === "walk") {
                const cid = `c-${sess.id}-0`, kid = `k-${sess.id}-0`;
                html += `<div class="row">
                    <div style="display:flex;align-items:center;">
                        <input type="checkbox" class="cb" id="${cid}" ${localStorage.getItem(cid)==='true'?'checked':''} onchange="triggerHaptic()"> 
                        <div class="task-info" style="margin-left:10px"><div class="task-name" style="font-size:14px; font-weight:bold">Recovery Walk</div></div>
                    </div>
                    <input type="text" class="iv small-box km-field" id="${kid}" value="${localStorage.getItem(kid)||''}" placeholder="km">
                </div>`;
            }
            const wKey = `water-${sess.id}`, waterVal = parseInt(localStorage.getItem(wKey)) || 0;
            html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:10px">
                <button class="water-btn ${waterVal>=3?'active':''}" onclick="addWater(${sess.id})">ðŸ’§ ${waterVal}/3L Water</button>
                <input type="text" class="iv small-box step-field" style="width:100%" id="s-${sess.id}" value="${localStorage.getItem('s-'+sess.id)||''}" placeholder="Steps">
            </div></div>`;
        });
        document.getElementById('content').innerHTML = html;
        calculateXP();
    }

    function addWater(id) { 
        let val = (parseInt(localStorage.getItem(`water-${id}`)) || 0) + 1; 
        localStorage.setItem(`water-${id}`, val > 3 ? 0 : val); 
        triggerHaptic(30);
        render(); 
    }

    function updateFocus(v) { localStorage.setItem('focus', v); render(); }

    function calculateXP() {
        let weeklyXP = 0, strXP = 0, gymTotal = 0, gymDone = 0;
        let waterTotal = 0;

        document.querySelectorAll('.cb').forEach(cb => { 
            gymTotal++;
            if(cb.checked) { 
                gymDone++;
                const kid = cb.id.replace('c-', 'k-');
                const val = parseFloat(document.getElementById(kid)?.value) || 0;
                if(document.getElementById(kid)?.classList.contains('km-field')) weeklyXP += val * 1.5; 
                else strXP += (2 + (val * 0.01));
            } 
        });

        document.querySelectorAll('.step-field').forEach(f => { weeklyXP += (parseInt(f.value) || 0) * 0.0005; });
        for(let i=0; i<7; i++) { 
            let w = parseInt(localStorage.getItem(`water-${i}`)) || 0;
            waterTotal += w;
            if(w >= 3) weeklyXP += 5; 
        }
        
        if(document.getElementById('daily-duty').checked) weeklyXP += 15;
        
        let banked = parseFloat(localStorage.getItem('lifetimeXP')) || 0;
        let total = banked + weeklyXP + strXP;
        
        // Level Logic
        let level = (total >= 10) ? Math.floor(Math.sqrt(total / 12)) + 1 : 1;
        const xpCurr = (level === 1) ? 0 : Math.pow(level - 1, 2) * 12, xpNext = Math.pow(level, 2) * 12;
        
        // Bars
        document.getElementById('xp-fill').style.width = Math.min(100, ((total - xpCurr) / (xpNext - xpCurr) * 100)) + "%";
        document.getElementById('hp-fill').style.width = Math.min(100, (waterTotal / 21) * 100) + "%";
        document.getElementById('mp-fill').style.width = Math.min(100, (gymDone / gymTotal) * 100) + "%";
        
        document.getElementById('xp-ratio').innerText = `${Math.round(total)} XP / LVL ${level}`;
        document.getElementById('stat-str').innerText = Math.round(strXP);
        document.getElementById('stat-total').innerText = Math.round(total);
        document.getElementById('stat-cycle').innerText = localStorage.getItem('cycleCount') || 0;
        
        // Rank Colors
        let rank = "E-RANK", color = "#444";
        if(level > 10) { rank = "D-RANK"; color = "#30d158"; }
        if(level > 30) { rank = "C-RANK"; color = "#00d4ff"; }
        if(level > 60) { rank = "B-RANK"; color = "#af52de"; }
        if(level > 90) { rank = "A-RANK"; color = "#ff3b30"; }
        if(level > 120) { rank = "S-RANK"; color = "#ffd700"; }
        document.getElementById('rank-display').innerText = `RANK: ${rank}`;
        document.getElementById('main-hud').style.setProperty('--rank-color', color);
    }

    function resetWeek() {
        if(!confirm("Finish Raid?")) return;
        triggerHaptic([100, 50, 100]);

        let wXP = 0, sXP = 0;
        document.querySelectorAll('.cb').forEach(cb => { 
            if(cb.checked) { 
                const kid = cb.id.replace('c-', 'k-');
                const val = parseFloat(document.getElementById(kid)?.value) || 0;
                if(document.getElementById(kid)?.classList.contains('km-field')) wXP += val * 1.5; else sXP += (2 + (val * 0.01));
            }
        });
        document.querySelectorAll('.step-field').forEach(f => { wXP += (parseInt(f.value) || 0) * 0.0005; });
        for(let i=0; i<7; i++) { if(localStorage.getItem(`water-${i}`) >= 3) wXP += 5; }
        if(document.getElementById('daily-duty').checked) wXP += 15;
        
        let banked = parseFloat(localStorage.getItem('lifetimeXP')) || 0;
        let oldLvl = (banked >= 10) ? Math.floor(Math.sqrt(banked / 12)) + 1 : 1;
        let newTotal = banked + wXP + sXP;
        let newLvl = (newTotal >= 10) ? Math.floor(Math.sqrt(newTotal / 12)) + 1 : 1;

        localStorage.setItem('lifetimeXP', newTotal);
        localStorage.setItem('cycleCount', (parseInt(localStorage.getItem('cycleCount') || 0) + 1));
        
        // Rotate Quest
        localStorage.setItem('activeQuest', quests[Math.floor(Math.random() * quests.length)]);

        if(newLvl > oldLvl) {
            document.getElementById('lvl-up-msg').innerText = `You have reached Level ${newLvl}`;
            document.getElementById('lvl-up-overlay').style.display = 'flex';
            setTimeout(() => { location.reload(); }, 3000);
        } else {
            location.reload();
        }

        // Clear Fields
        sessions.forEach(sess => { 
            for(let j=0; j<10; j++) { localStorage.removeItem(`c-${sess.id}-${j}`); localStorage.removeItem(`k-${sess.id}-${j}`); localStorage.removeItem(`t-${sess.id}-${j}`); } 
            localStorage.removeItem(`water-${sess.id}`); localStorage.removeItem(`s-${sess.id}`); 
        });
        localStorage.removeItem('daily-duty');
    }

    document.addEventListener('input', (e) => { if(e.target.id) localStorage.setItem(e.target.id, e.target.type === 'checkbox' ? e.target.checked : e.target.value); calculateXP(); });
    window.onload = render;
</script>
</body>
</html>
